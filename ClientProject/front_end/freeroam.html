<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Parkour Character Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: url("https://raw.githubusercontent.com/m-gunuru/ClientProject/refs/heads/Test/ClientProject/front_end/image0.png") center center / cover no-repeat;
            font-family: "Press Start 2P", monospace;
            overflow: hidden;
        }
        #game-area {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #character {
            position: absolute;
            width: 120px;
            height: auto;
            z-index: 2;
            user-select: none;
            pointer-events: none;
            transition: filter 0.2s;
        }
        #character.flipped {
            transform: scaleX(-1);
        }
        .platform {
            position: absolute;
            background: #c8a963;
            border: 3px solid #886d3a;
            border-radius: 8px;
            z-index: 1;
            box-shadow: 0 4px 12px #000a;
        }
        #ground {
            position: absolute;
            left: 0;
            width: 100vw;
            background: #835c34;
            border-top: 5px solid #fff5e0;
            z-index: 1;
        }
        #settingsBtn {
            background: #3a4fa0;
            color: white;
            border: 2px solid #fff;
            border-radius: 8px;
            font-size: 1rem;
            font-family: "Press Start 2P", monospace;
            padding: 12px 34px;
            text-shadow: 3px 5px 1px #00000094;
            transition: background 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            position:fixed;
            top:20px;
            right:20px;
            z-index:1000;
            min-width: 100px;
            cursor: pointer;
        }
        #settingsBtn:hover { background: #1d2558; }
        #settingsModal {
            display:none;
            position:fixed;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
            background:#3a4fa0;
            border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.3);
            z-index:2000;
            padding: 36px 40px 36px 40px;
            color:#fff;
            font-family: "Press Start 2P", monospace;
            min-width: 300px;
        }
        #settingsModal h2 { margin-top:0; }
        #settingsModal input[type="range"]{ width: 160px;}
        #settingsModal .button {
            background: #1d2558;
            color: white;
            border: 2px solid #fff;
            border-radius: 8px;
            font-size: 1rem;
            font-family: "Press Start 2P", monospace;
            padding: 8px 20px;
            margin: 8px 6px 0 0;
            cursor:pointer;
        }
        #settingsModal .button:hover { background: #3a4fa0; }
        @media (max-width: 600px) {
            #character { width: 80px; }
            #settingsModal { min-width: 180px; padding: 18px 8vw 18px 8vw; }
        }
    </style>
</head>
<body>
    <audio id="bg-music" preload="auto" loop>
      <source src="Pokemon BW2 Iris Battle Remix.mp3" type="audio/mpeg">
    </audio>
    <div id="game-area">
        <!-- Character -->
        <img 
            id="character" 
            src="https://raw.githubusercontent.com/ananya-k-a/ClientProject/refs/heads/main/ClientProject/front_end/output-onlinegiftools.gif" 
            alt="Character" 
        />
        <!-- Ground and platforms will be injected here -->
    </div>
    <!-- Settings Button -->
    <button id="settingsBtn">Settings</button>
    <!-- Settings Modal -->
    <div id="settingsModal">
        <h2>Settings</h2>
        <label for="volumeSlider">Volume:</label>
        <input type="range" id="volumeSlider" min="0" max="100" step="1"><span id="volumeValue"></span>%
        <br><br>
        <button id="saveSettingsBtn" class="button">Save</button>
        <button id="closeSettingsBtn" class="button">Close</button>
    </div>
    <script>
    // --- Music & Settings Logic ---
    window.onload = function() {
        // Play music on first user interaction (browser policy)
        let musicStarted = false;
        function tryPlayMusic() {
            if (!musicStarted) {
                document.getElementById('bg-music').play().catch(()=>{});
                musicStarted = true;
            }
        }
        window.addEventListener('keydown', tryPlayMusic, { once: true });
        window.addEventListener('mousedown', tryPlayMusic, { once: true });

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('gameSettings')) || { volume: 100 };
            document.getElementById('volumeSlider').value = settings.volume;
            document.getElementById('volumeValue').textContent = settings.volume;
            document.getElementById('bg-music').volume = settings.volume / 100;
            return settings;
        }
        function saveSettings() {
            const volume = parseInt(document.getElementById('volumeSlider').value, 10);
            localStorage.setItem('gameSettings', JSON.stringify({ volume }));
            alert('Settings saved!');
        }
        const modal = document.getElementById('settingsModal');
        document.getElementById('settingsBtn').onclick = function() {
            modal.style.display = 'block';
            loadSettings();
        };
        document.getElementById('closeSettingsBtn').onclick = function() {
            modal.style.display = 'none';
        };
        document.getElementById('saveSettingsBtn').onclick = function() {
            saveSettings();
            modal.style.display = 'none';
        };
        document.getElementById('volumeSlider').oninput = function() {
            document.getElementById('volumeValue').textContent = this.value;
            document.getElementById('bg-music').volume = this.value / 100;
        };
        loadSettings();
    };

    // --- Game & Platform Logic ---
    const char = document.getElementById('character');
    const charWidth = 120;
    const charHeight = 120; // Approximate height for collision
    const gameArea = document.getElementById('game-area');

    // --- Ground and Platforms ---
    const groundHeight = 180; // px from bottom
    // Platform format: [x, y, width, height] (y from bottom)
    const platforms = [
        [350, 340, 130, 25],
        [600, 250, 110, 25],
        [900, 210, 110, 25],
        [1200, 370, 140, 25],
        [190, 420, 100, 25],
        [800, 520, 100, 25],
        [window.innerWidth-300, 320, 160, 25]
    ];

    // Draw ground
    function drawGround() {
        let ground = document.getElementById('ground');
        if (!ground) {
            ground = document.createElement('div');
            ground.id = "ground";
            gameArea.appendChild(ground);
        }
        ground.style.bottom = '0px';
        ground.style.height = groundHeight+'px';
    }

    // Draw platforms
    function drawPlatforms() {
        // Remove old platforms
        Array.from(document.getElementsByClassName('platform')).forEach(e=>e.remove());
        for (let i=0; i<platforms.length; i++) {
            const [x, y, w, h] = platforms[i];
            let pf = document.createElement('div');
            pf.className = 'platform';
            pf.style.left = x+'px';
            pf.style.bottom = y+'px';
            pf.style.width = w+'px';
            pf.style.height = h+'px';
            gameArea.appendChild(pf);
        }
    }

    function redrawAll() {
        drawGround();
        drawPlatforms();
    }
    redrawAll();

    // --- Character Movement Logic ---
    let pos = { x: 200, y: groundHeight }; // Start on the ground, shifted from left edge
    let velocity = { x: 0, y: 0 };
    let move = { left: false, right: false, jump: false };
    let onGround = false;
    let lastDirection = "right";
    const speed = 5;
    const jumpStrength = 17;
    const gravity = 0.9;

    function rectsIntersect(ax, ay, aw, ah, bx, by, bw, bh) {
        return (ax < bx + bw &&
                ax + aw > bx &&
                ay < by + bh &&
                ay + ah > by);
    }

    function getStandingPlatform() {
        // Returns the y of the platform the character is standing on, or null
        // We'll use a small vertical tolerance for collision
        for(let i=0; i<platforms.length; i++) {
            const [x, y, w, h] = platforms[i];
            if (
                pos.x + charWidth > x + 5 && pos.x < x + w - 5 && // horizontal overlap
                pos.y - 2 <= y + h && pos.y - 2 >= y + h - 17 // vertical tolerance (standing ON)
            ) {
                return y + h;
            }
        }
        // Check ground
        if (pos.y <= groundHeight + 2 && pos.y >= groundHeight - 20) {
            return groundHeight;
        }
        return null;
    }

    function getCeilingCollision() {
        // Check if the top of the character is bumping into the bottom of a platform
        for(let i=0; i<platforms.length; i++) {
            const [x, y, w, h] = platforms[i];
            if (
                pos.x + charWidth > x + 5 && pos.x < x + w - 5 &&
                pos.y + charHeight > y && pos.y + charHeight < y + h + 16
            ) {
                return y;
            }
        }
        return null;
    }

    function updateCharPosition() {
        // Horizontal movement
        velocity.x = 0;
        if (move.left) velocity.x = -speed;
        else if (move.right) velocity.x = speed;
        // Vertical movement (jump and gravity)
        if (move.jump && onGround) {
            velocity.y = jumpStrength;
            onGround = false;
        }
        velocity.y -= gravity;

        // Save previous position for collision correction
        let prevY = pos.y;

        pos.x += velocity.x;
        pos.y += velocity.y;

        // --- Collision with ground/platforms (vertical, landing) ---
        let standingY = getStandingPlatform();
        if (standingY !== null && velocity.y <= 0 && pos.y <= standingY) {
            pos.y = standingY;
            velocity.y = 0;
            onGround = true;
        } else {
            onGround = false;
        }
        // --- Ceiling collision (hitting head) ---
        let bumpY = getCeilingCollision();
        if (bumpY !== null && velocity.y > 0 && pos.y + charHeight > bumpY) {
            pos.y = bumpY - charHeight;
            velocity.y = -2;
        }

        // Boundaries
        const rightBound = window.innerWidth - charWidth;
        if (pos.x < 0) pos.x = 0;
        if (pos.x > rightBound) pos.x = rightBound;

        // Don't let fall below the ground
        if (pos.y < groundHeight) {
            pos.y = groundHeight;
            velocity.y = 0;
            onGround = true;
        }
        // Don't let go above screen
        const ceiling = window.innerHeight - 80;
        if (pos.y > ceiling) pos.y = ceiling;

        // Apply position
        char.style.left = pos.x + 'px';
        char.style.bottom = pos.y + 'px';
    }

    function gameLoop() {
        updateCharPosition();
        requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // --- Keyboard Controls ---
    window.addEventListener('keydown', function(e) {
        if (["INPUT", "TEXTAREA"].includes(document.activeElement.tagName)) return;
        switch(e.key.toLowerCase()) {
            case "a":
                move.left = true;
                lastDirection = "left";
                char.classList.add('flipped');
                break;
            case "d":
                move.right = true;
                lastDirection = "right";
                char.classList.remove('flipped');
                break;
            case " ": move.jump = true; break;
        }
    });
    window.addEventListener('keyup', function(e) {
        switch(e.key.toLowerCase()) {
            case "a":
                move.left = false;
                if (move.right) {
                    lastDirection = "right";
                    char.classList.remove('flipped');
                }
                break;
            case "d":
                move.right = false;
                if (move.left) {
                    lastDirection = "left";
                    char.classList.add('flipped');
                }
                break;
            case " ": move.jump = false; break;
        }
    });

    // --- Responsive resize (and platform reposition on resize) ---
    window.addEventListener('resize', ()=>{
        // Move last platform to near the right edge
        platforms[platforms.length-1][0] = window.innerWidth-300;
        redrawAll();
        // Keep character within bounds
        const rightBound = window.innerWidth - charWidth;
        if(pos.x > rightBound) pos.x = rightBound;
        char.style.left = pos.x + "px";
    });

    </script>
</body>
</html>
