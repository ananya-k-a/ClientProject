<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: url('image0.png') center center / cover no-repeat;
      font-family: 'Press Start 2P', monospace;
      color: white;
      overflow: hidden;
    }

    .dialogue-container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }

    .character {
      position: absolute;
      bottom: 0;           
      object-fit: contain;
      transition: opacity 0.2s, height 0.2s, transform 0.3s ease;
      user-select: none;
      pointer-events: none;
      z-index: 1;
      opacity: 0.3;
      transform: none; 
    }

    .character.active {
      opacity: 1;
      z-index: 2;
    }

    /* Bounce animation for talking */
    @keyframes bounce-talk {
      0% { transform: scale(1.5); }
      30% { transform: scale(1.6) translateY(-15px); }
      50% { transform: scale(1.5) translateY(0); }
      70% { transform: scale(1.4) translateY(-8px); }
      100% { transform: scale(1.5) translateY(0); }
    }

    .character.active.talking {
      animation: bounce-talk 0.6s ease forwards;
      opacity: 1 !important;
    }

    .left-character {
      left: 0;        
      height: 520px; /* Pebble slightly bigger */
    }

    .left-character.active {
      height: 520px;
    }

    .right-character {
      right: 30px;
      bottom: 0;
      height: 320px;
    }

    .dialogue-box {
      position: absolute;
      bottom: 20px; 
      left: 50%;
      transform: translateX(-50%);
      width: 85vw;
      max-width: 1000px;
      background: rgba(0, 0, 0, 0.7);
      padding: 24px 32px 60px;
      border: 2.5px solid #fff;
      border-radius: 18px;
      box-shadow: 0 -4px 16px #000a;
      z-index: 2;
    }

    .popup-box {
      position: absolute;
      left: 50%;
      bottom: 360px;
      transform: translateX(-50%);
      width: 85vw;
      max-width: 1000px;
      background: rgba(0, 0, 0, 0.85);
      padding: 32px;
      border: 2.5px solid #fff;
      border-radius: 18px;
      box-shadow: 0 -4px 24px #000a;
      z-index: 3;
      display: none;
    }

    .popup-content label {
      display: block;
      margin-bottom: 12px;
      font-size: 1rem;
    }

    .speaker-name {
      font-size: 1rem;
      color: #ffeb3b;
      margin-bottom: 10px;
      text-shadow: 2px 2px #000;
      letter-spacing: 2px;
    }

    .dialogue-text {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #fff;
      text-shadow: 1px 1px 3px #000;
      min-height: 2em;
    }

    .next-btn, .back-btn {
      position: absolute;
      bottom: 20px;
      background: #3a4fa0;
      color: white;
      border: 2px solid #fff;
      padding: 12px 34px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-family: 'Press Start 2P', monospace;
      text-shadow: 3px 5px 1px #00000094;
      transition: background 0.2s;
      z-index: 3;
    }

    .next-btn {
      right: 32px;
    }

    .back-btn {
      left: 32px;
    }

    .next-btn:disabled, .back-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .next-btn:hover:not(:disabled), .back-btn:hover:not(:disabled) {
      background: #1d2558;
    }

    @media (max-width: 900px) {
      .character {
        height: 300px;
        bottom: 70px;
      }
      .character.active {
        height: 400px;
      }
      .popup-box {
        bottom: 150px;
        padding: 18px 10px 18px;
      }
    }

    @media (max-width: 600px) {
      .character {
        height: 200px;
        bottom: 50px;
      }
      .character.active {
        height: 300px;
      }
      .popup-box {
        bottom: 110px;
        padding: 10px 3vw 10px;
      }
    }
  </style>
</head>
<body>
  <div class="dialogue-container">
    <img src="https://raw.githubusercontent.com/m-gunuru/ClientProject/Test/ClientProject/front_end/PebbleMouthClosed.png" class="character left-character" id="pebble" />
    <img src="https://raw.githubusercontent.com/m-gunuru/ClientProject/Test/ClientProject/front_end/HamMouthClosed.png" class="character right-character" id="ham" />
    <img src="construction1.gif" id="constructionGif" style="display: none; position: absolute; left: 50%; bottom: 360px; transform: translateX(-50%); width: 85vw; max-width: 1000px; height: auto; z-index: 3;" />/>
    <div class="popup-box" id="popupBox">
      <div class="popup-content">
        <p>Construct can be used in which of the following sentences:</p>
        <label><input type="checkbox" class="popupCheckbox" value="1"> Molly wants to ____ a barn.</label>
        <label><input type="checkbox" class="popupCheckbox" value="1"> Jane wants the town to ____ a community center.</label>
        <label><input type="checkbox" class="popupCheckbox" value="1"> Paul used an organizer to ____ his essay.</label>
        <button class="next-btn" style="position: relative; bottom: 0; margin-top: 12px;" onclick="checkAnswers()">Submit</button>
      </div>
    </div>

    <div class="dialogue-box">
      <div class="speaker-name" id="speakerName">Click to Start</div>
      <div class="dialogue-text" id="dialogueText">Click below to begin the story...</div>
    </div>

    <button class="back-btn" onclick="prevDialogue()" id="backBtn" disabled>Back</button>
    <button class="next-btn" onclick="nextDialogue()" id="nextBtn">Next</button>
  </div>

<script>
  const dialogues = [
    { speaker: "Pebble", text: "Meet Ham the Hammer! Ham, I need your help.. I need to build a house!" },
    { speaker: "Ham", text: "Hey there Pebbles! It sounds like you want to construct a house!" },
    { speaker: "Pebble", text: "Construct? What does that mean?" },
    { speaker: "Ham", text: "I'll teach you! Construct has two roots: Con - Together, Struct - to build." },
    { speaker: "Ham", text: "If you put these roots together, you make a new word, which means to make something!" },
    { speaker: "Ham", text: "For example, I can construct a word by merging the two roots, ‘con’ and ‘struct’!" },
    { speaker: "Ham", text: "I can also help you to construct a house!" },
    { speaker: "Pebble", text: "Ah I see, so that would mean..." },
    { speaker: "Pebble", text: "H5", popup: true },
    { speaker: "Ham", text: "Construct can be used in ALL of the following sentences: \n Molly wants to construct a barn. \n Jane wants the town to construct a community center. \n Paul used an organizer to construct his essay."},
     { speaker: "Ham", text: "Molly wants to construct a barn. \n Here, Molly wants to perform the action of making a barn. The action of doing this requires the assembly of parts to build the barn. This allows us to use the word construct."},
     { speaker: "Ham", text: "Jane wants the town to construct a community center. \n Here, Jane wants the town to build a community center. Buildings require an assembly of parts to build it. This allows for the word construct to be used."},
     { speaker: "Ham", text: "Paul used an organizer to construct his essay. \n An organizer is used in English classes, to help structure an essay, breaking it up into smaller parts. These parts are assembled together to form an essay. This allows for the use of the word construct."},
     { speaker: "Ham", text: "There you go! Good job! Although, I don’t do work for free, prove to me that you learned ‘construct’, and I’ll help you make this place a home."}
    ];

  let currentIndex = 0;
  let popupSubmitted = false;

  const textElem = document.getElementById("dialogueText");
  const speakerElem = document.getElementById("speakerName");
  const pebbleImg = document.getElementById("pebble");
  const hamImg = document.getElementById("ham");
  const popupBox = document.getElementById("popupBox");
  const backBtn = document.getElementById("backBtn");
  const nextBtn = document.getElementById("nextBtn");

  let typingTimeout;

  function typeText(text, i = 0) {
    if (i < text.length) {
      textElem.textContent += text.charAt(i);
     typingTimeout = setTimeout(() => typeText(text, i + 1), 60);
    } else {
      nextBtn.disabled = currentIndex >= dialogues.length - 1;
    }
  }

  function updateDialogue(index) {
    clearTimeout(typingTimeout);

    const current = dialogues[index];
    speakerElem.textContent = current.speaker;
    const constructionGif = document.getElementById("constructionGif");
if (
  current.speaker === "Ham" &&
  current.text === "I can also help you to construct a house!"
) {
  constructionGif.style.display = "block";
} else {
  constructionGif.style.display = "none";
}
    backBtn.disabled = index === 0;

    if (current.popup && !popupSubmitted) {
      popupBox.style.display = "block";
      nextBtn.disabled = true;
      textElem.textContent = ""; // Clear text waiting for popup
      document.querySelectorAll(".popupCheckbox").forEach(cb => cb.checked = false);
    } else {
      popupBox.style.display = "none";
      nextBtn.disabled = true; // Disable while typing
      textElem.textContent = "";
      typeText(current.text);
    }

    // Remove all active and talking classes first
    pebbleImg.classList.remove("active", "talking");
    hamImg.classList.remove("active", "talking");

    // Add active and talking to current speaker to trigger bounce + scale
    if (current.speaker === "Pebble") {
      pebbleImg.classList.add("active", "talking");
    } else if (current.speaker === "Ham") {
      hamImg.classList.add("active", "talking");
    }
  }

  function nextDialogue() {
    if (dialogues[currentIndex].popup && !popupSubmitted) return;
    if (currentIndex < dialogues.length - 1) {
      currentIndex++;
      popupSubmitted = false;
      updateDialogue(currentIndex);
    }
  }

  function prevDialogue() {
    if (currentIndex > 0) {
      currentIndex--;
      popupSubmitted = false;
      updateDialogue(currentIndex);
    }
  }

  function checkAnswers() {
    const checkboxes = document.querySelectorAll(".popupCheckbox");
    let allCorrect = true;
    checkboxes.forEach(cb => {
      if ((cb.checked && cb.value !== "1") || (!cb.checked && cb.value === "1")) {
        allCorrect = false;
      }
    });

    if (allCorrect) {
      speakerElem.textContent = "Ham";
      textElem.textContent = "Correct ✅";
      popupSubmitted = true;
      setTimeout(() => {
        nextDialogue();
      }, 1000);
    } else {
      speakerElem.textContent = "Ham";
      textElem.textContent = "Wrong ❌ Try again!";
    }
  }

  window.onload = () => updateDialogue(currentIndex);
</script>

</body>
</html>
